<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Electric Boogaloo</title>
	<style type='text/css'>
		canvas { border: 1px solid black; }
	</style>
</head>
<body>
	<canvas id='canvas' width='800' height='600'></canvas>
	<script type='text/javascript'>
		var ctx;
		var pattern;
		var timerID = -1;
		var mouse = { x: 0, y: 0, clicked: false };
		var playButton = {};
		var menuButton = {};
		var storyButton = {};
		var currentSlide = 1;
		var nextSlideButton = {};
		var swordOut = false;
		var collright, collleft, collup, colldown;
		var stage =1;
		
		var player = { x: 5, y: 5, w: 50, h: 50, dx: 5, dy: 5, health: 5 };
		var enemy1 = { x: 200, y: 20, w: 35, h: 35, dx: 1, dy: 0, health: 2 };
		
		var SP;
		var SP1 = {}
		var SP2 = {}
		var SP3 = {}
		var SP4 = {}
		
		var MENU = 0, PLAY = 1, PLOT = 2;
		var state = MENU;
		
		var left = false, right = false, up = false, down = false;			
		var box1 = { x: 100, y: 0,   w: 50,  h: 450 };
		var box2 = { x: 500, y: 0,   w: 100, h: 400 };
		var box3 = { x: 100, y: 550, w: 50,  h: 50 };
		var box4 = { x: 150, y: 60,  w: 250, h: 50};
		var boxWdoor = { x: 650, y: 0,  w: 100, h: 50};
		
		var box5 = { x: 200, y: 400,   w: 50,  h: 200 };
		var box6 = { x: 650, y: 0,   w: 50,  h: 500 };
		var box7 = { x: 75, y: 75,   w: 450,  h: 50 };
		var box8 = { x: 0, y: 450,   w: 150,  h: 50 };

		player.img = new Image();
		player.ready = false;
		player.img.onload = function() {
			player.ready = true;
		}
		player.img.src = "Player.jpg";
		
		enemy1.img = new Image();
		enemy1.ready = false;
		enemy1.img.onload = function() {
			enemy1.ready = true;
		}
		enemy1.img.src = "Enemy1.png";
		
		var storyBoard1 = new Image();
		storyBoard1.ready = false;
		storyBoard1.onload = function() {
			storyBoard1.ready = true;
		}
		storyBoard1.src = "MitchellSlide1.jpg";
		
		var storyBoard2 = new Image();
		storyBoard2.ready = false;
		storyBoard2.onload = function() {
			storyBoard2.ready = true;
		}
		storyBoard2.src = "MitchellSlide2.jpg";
		
		var BGI = new Image();
		BGI.ready = false;
		BGI.onload = function() {
			BGI.ready = true;
		}
		BGI.src = "BGI.jpg";
		
		var BGI2 = new Image();
		BGI2.ready = false;
		BGI2.onload = function() {
			BGI2.ready = true;
		}
		BGI2.src = "BGI2.jpg";
		
		var tile = new Image();
		tile.ready = false;
		tile.onload = function() {
			tile.ready = true;
		}
		tile.src = "tile.jpg";
		
		var DarkMossy = new Image();
		DarkMossy.ready = false;
		DarkMossy.onload = function() {
			DarkMossy.ready = true;
		}
		DarkMossy.src = "DarkMossy.png";
		
		function contains( r, m ) {
			return ! (r.x>m.x || r.y>m.y || m.x>r.x+r.w || m.y>r.y+r.h );
		}
		
		function getClick(e) {
			var evt = e || window.event;
			mouse.x = evt.pageX - ctx.canvas.offsetLeft;
			mouse.y = evt.pageY - ctx.canvas.offsetTop;
			mouse.clicked = true;
		}
		function init()
		{
			ctx.font = "24pt Arial, sans-serif";
			ctx.textBaseline = "top";
			playButton.x = ctx.canvas.width/2 - 100;
			playButton.y = ctx.canvas.height/2 - 150;
			playButton.w = 200;
			playButton.h = 100;
			
			menuButton.x = ctx.canvas.width - 65;
			menuButton.y = ctx.canvas.height - 30;
			menuButton.w = 60;
			menuButton.h = 25;
			
			storyButton.x = ctx.canvas.width/2 - 100;
			storyButton.y = ctx.canvas.height/2;
			storyButton.w = 200;
			storyButton.h = 100;
			
			nextSlideButton.x = 645
			nextSlideButton.y = 0
			nextSlideButton.w = 100;
			nextSlideButton.h = 100;
		}
		// changes game state when clicked
		function changeState( newState ) {
			if ( timerID != -1 )
				clearInterval(timerID);
			if ( newState === MENU )
				timerID = setInterval(function() { updateMenu(); drawMenu(ctx); }, 1000/60);
			else if ( newState === PLAY ) {
				//reset();
				timerID = setInterval(function() { update(); drawPlay(ctx); }, 1000/60);
			}
			else if ( newState === PLOT ) {
				timerID = setInterval(function() { update(); drawPlot(ctx); }, 1000/60);
			}
			state = newState;
		}
			
		function update() {
			var orig = { x: player.x, y: player.y };
			
			// move the player
			if ( up == true )
				player.y -= player.dy;
			if ( down == true )
				player.y += player.dy;					
			if ( left == true )
				player.x -= player.dx;
			if ( right == true )
				player.x += player.dx;
			console.log(player.x+" "+player.y);
			
			SP1 = { x: player.x+20, y: player.y-40, w: 10, h: 40};
			SP2 = { x: player.x+50, y: player.y+20, w: 40, h: 10};
			SP3 = { x: player.x+20, y: player.y+50, w: 10, h: 40};
			SP4 = { x: player.x-40, y: player.y+20, w: 40, h: 10};
				
			//check if the player ran into a box and, if so, move back
			if (( collide(player, box1) || collide(player, box2) || collide(player, box3) || collide(player, box4)) && stage == 1 )  {
				player.x = orig.x;
				player.y = orig.y; }
			
			if (( collide(player, box5) || collide(player, box6) || collide(player, box7) || collide(player, box8)) && stage == 2 )  {
				player.x = orig.x;
				player.y = orig.y; }
			
			if ( player.x < 0 )
				player.x = 0;
			else if ( player.x + player.w > ctx.canvas.width )
				player.x = ctx.canvas.width - player.w;
			else if ( player.y < 0)
				player.y = 0;
			else if ( player.y + player.h > ctx.canvas.height )
				player.y = ctx.canvas.height - player.h;
			
				
			enemy1.x += enemy1.dx;
			enemy1.y += enemy1.dy;
			
			if ( enemy1.x == 420 && enemy1.dx == 1 ) {
				enemy1.dx = 0;
				enemy1.dy = 1;
			}
			if ( enemy1.y == 450 && enemy1.dy == 1 ) {
				enemy1.dy = 0;
				enemy1.dx = -1;
			}
			if ( enemy1.x == 200 && enemy1.dx == -1 ) {
				enemy1.dy = -1;
				enemy1.dx = 0;
			}
			if ( enemy1.y == 200 && enemy1.dy == -1 ) {
				enemy1.dy = 0;
				enemy1.dx = 1;
			}
			
			console.log(enemy1.health);

			
			/*while (enemy1.x >= 450 && enemy1.y <= 570){
				enemy1.dy = 2;
				enemy1.dx = 0;
			}
			while (enemy1.y >= 570 && enemy.x >= 200 ){
				enemy1.dx = -2;
				enemy1.dy = 0;	
			}
			while (enemy1.x <= 200 && enemy.y <= 150 ){
				enemy1.dy = -2;
				enemy1.dx = 0;	
			}
			while (enemy1.y <= 150 && enemy1.x <= 450){
				enemy1.dx = 2;
				enemy1.dy = 0;
			}	
			var origY = enemy1.y;

			var origY = enemy1.y;

			var origX = enemy1.x;
			
			enemy1.x += enemy1.dx;	
			enemy1.y += enemy1.dy;
			
			console.log("x:"+enemy1.x+" y:"+enemy1.y+" dx:"+enemy1.dx+" dy:"+enemy1.dy);
			
			if ( collide(enemy1, box1) || collide(enemy1, box2) || collide(enemy1, box3) || collide(enemy1, box4) || (enemy1.y < 0 ) || (enemy1.x<0) || (enemy1.y + enemy1.h> ctx.canvas.height ) || (enemy1.x + enemy1.w > ctx.canvas.width)) 
			{
				if ( collup || colldown ) {
					enemy1.dy = -enemy1.dy;
				}
				else if ( collleft || collright ) {
					enemy1.dx = -enemy1.dx;
				}
				enemy1.x = origX;
				enemy1.y = origY; 
				collleft = false;
				collright = false;
				collup = false;
				colldown = false;
			}*/
			if ((player.x>=650 && player.x <= 750) && (player.y <= 50)){
				stage = 2;
				player.y = 525;
				player.x = 50;
			}
		} 
		
		function updateMenu() {
			if ( mouse.clicked && contains(playButton, mouse) === true ) {
					changeState(PLAY);
			}
			else if ( mouse.clicked && contains (storyButton, mouse) === true ) {
					changeState(PLOT);
			}
			mouse.clicked = false;
		}
		
		function drawMenu(ctx) {
			ctx.font = "24pt Arial, sans-serif";
			ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
			ctx.strokeRect(playButton.x, playButton.y, playButton.w, playButton.h);
			ctx.strokeRect(storyButton.x, storyButton.y, storyButton.w, storyButton.h);
			ctx.fillText("[PLAY]", playButton.x+55, playButton.y+30);
			ctx.fillText("[PLOT]", storyButton.x+55, storyButton.y+30);
		}
		function collide( player, box ) {
			if( player.x >= box.x + box.w ){
				collleft = true;
				return false;
			}
			else if ( box.x >= player.x + player.w ){
				collright = true;
				return false;
			}
			else if ( player.y >= box.y + box.h ){
				colldown = true;
				return false;
			}
			else if ( box.y >= player.y + player.h ){
				collup = true;
				return false;
			}
			
			return true;
		}
	
// Draws the character as well as the obstetrical on the map
		
		function drawPlay(ctx) {
			ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
			if (stage == 1){
				if ( BGI.ready )
					ctx.drawImage(BGI, 0, 0 );
				
				ctx.fillStyle = "#000000";
				ctx.font = "12pt Arial, sans-serif";
				ctx.strokeRect(menuButton.x, menuButton.y, menuButton.w, menuButton.h);
				ctx.fillText("[MENU]", menuButton.x+2, menuButton.y+3);
				
				if ( mouse.clicked && contains(menuButton, mouse) === true ) {
					changeState(MENU);
					ctx.font = "24pt Arial, sans-serif";
				}
				mouse.clicked = false;
				
				// draw da sord
				if ( swordOut == true ) {
					ctx.fillStyle = "#6E4600";
					if ( SP == 1 ) {
						ctx.fillRect(SP1.x, SP1.y, SP1.w, SP1.h);
						if ( contains(SP1, enemy1 || SP1, enemy1 ) == true)
							enemy1.health = enemy1.health - 1;
					}
					else if ( SP == 2 ){
						ctx.fillRect(SP2.x, SP2.y, SP2.w, SP2.h);
						if ( contains(SP2, enemy1 || SP2, enemy1 ) == true)
							enemy1.health = enemy1.health - 1;
					}
					else if ( SP == 3 ){
						ctx.fillRect(SP3.x, SP3.y, SP3.w, SP3.h);
						if ( contains(SP3, enemy1 || SP3, enemy1 ) == true)
							enemy1.health = enemy1.health - 1;
					}
					else if ( SP == 4 ){
						ctx.fillRect(SP4.x, SP4.y, SP4.w, SP4.h);
						if ( contains(SP4, enemy1 || SP4, enemy1 ) == true)
							enemy1.health = enemy1.health - 1;
					}
				}
				
				if ( player.ready )
					ctx.drawImage(player.img, player.x, player.y );
				
				if ( enemy1.health > 0 )
					if ( enemy1.ready )
						ctx.drawImage(enemy1.img, enemy1.x, enemy1.y );
				
				ctx.fillStyle = "#000000";
				ctx.fillRect(boxWdoor.x, boxWdoor.y, boxWdoor.w, boxWdoor.h)
// I'm so sorry
				ctx.fillRect(box1.x, box1.y, box1.w, box1.h);
				if ( tile.ready ){
					ctx.drawImage(tile, box1.x, box1.y );				
					ctx.drawImage(tile, box1.x, box1.y + 50 );
					ctx.drawImage(tile, box1.x, box1.y + 100 );				
					ctx.drawImage(tile, box1.x, box1.y + 150 );				
					ctx.drawImage(tile, box1.x, box1.y + 200 );				
					ctx.drawImage(tile, box1.x, box1.y + 250 );				
					ctx.drawImage(tile, box1.x, box1.y + 300 );				
					ctx.drawImage(tile, box1.x, box1.y + 350 );				
					ctx.drawImage(tile, box1.x, box1.y + 400 );					
					ctx.drawImage(tile, box2.x, box2.y );				
					ctx.drawImage(tile, box2.x, box2.y + 50 );				
					ctx.drawImage(tile, box2.x, box2.y + 100 );				
					ctx.drawImage(tile, box2.x, box2.y + 150 );				
					ctx.drawImage(tile, box2.x, box2.y + 200 );				
					ctx.drawImage(tile, box2.x, box2.y + 250 );				
					ctx.drawImage(tile, box2.x, box2.y + 300 );				
					ctx.drawImage(tile, box2.x, box2.y + 350 );				
					ctx.drawImage(tile, box2.x + 50, box2.y );				
					ctx.drawImage(tile, box2.x + 50, box2.y + 50 );				
					ctx.drawImage(tile, box2.x + 50, box2.y + 100 );
					ctx.drawImage(tile, box2.x + 50, box2.y + 150 );				
					ctx.drawImage(tile, box2.x + 50, box2.y + 200 );				
					ctx.drawImage(tile, box2.x + 50, box2.y + 250 );				
					ctx.drawImage(tile, box2.x + 50, box2.y + 300 );				
					ctx.drawImage(tile, box2.x + 50, box2.y + 350 );				
					ctx.drawImage(tile, box3.x, box3.y );			
					ctx.drawImage(tile, box4.x, box4.y );				
					ctx.drawImage(tile, box4.x + 50, box4.y );				
					ctx.drawImage(tile, box4.x + 100, box4.y );
					ctx.drawImage(tile, box4.x + 150, box4.y );
					ctx.drawImage(tile, box4.x + 200, box4.y );
					ctx.drawImage(tile, 600, 0 );
					ctx.drawImage(tile, 750, 0 );
				}
			}
			if (stage == 2){
				if ( BGI2.ready )
					ctx.drawImage(BGI2, 0, 0 );
					
				if ( DarkMossy.ready ){
					ctx.drawImage(DarkMossy, box5.x, box5.y);
					ctx.drawImage(DarkMossy, box5.x, box5.y+50);
					ctx.drawImage(DarkMossy, box5.x, box5.y+100);
					ctx.drawImage(DarkMossy, box5.x, box5.y+150);
					
					ctx.drawImage(DarkMossy, box8.x, box8.y);
					ctx.drawImage(DarkMossy, box8.x+50, box8.y);
					ctx.drawImage(DarkMossy, box8.x+100, box8.y);
					
					ctx.drawImage(DarkMossy, box6.x, box6.y);
					ctx.drawImage(DarkMossy, box6.x, box6.y+50);
					ctx.drawImage(DarkMossy, box6.x, box6.y+100);
					ctx.drawImage(DarkMossy, box6.x, box6.y+150);
					ctx.drawImage(DarkMossy, box6.x, box6.y+200);
					ctx.drawImage(DarkMossy, box6.x, box6.y+250);
					ctx.drawImage(DarkMossy, box6.x, box6.y+300);
					ctx.drawImage(DarkMossy, box6.x, box6.y+350);
					ctx.drawImage(DarkMossy, box6.x, box6.y+400);
					ctx.drawImage(DarkMossy, box6.x, box6.y+450);
					var box7 = { x: 75, y: 75,   w: 450,  h: 50 };
					ctx.drawImage(DarkMossy, box7.x, box7.y);
					ctx.drawImage(DarkMossy, box7.x+50, box7.y);
					ctx.drawImage(DarkMossy, box7.x+100, box7.y);
					ctx.drawImage(DarkMossy, box7.x+150, box7.y);
					ctx.drawImage(DarkMossy, box7.x+200, box7.y);
					ctx.drawImage(DarkMossy, box7.x+250, box7.y);
					ctx.drawImage(DarkMossy, box7.x+300, box7.y);
					ctx.drawImage(DarkMossy, box7.x+350, box7.y);
					ctx.drawImage(DarkMossy, box7.x+400, box7.y);
				}
				if ( player.ready )
					ctx.drawImage(player.img, player.x, player.y );
			}
		}
		

// Draws the plot screens.
		
		function drawPlot(ctx) {
			ctx.font = "12pt Arial, sans-serif";
			ctx.strokeRect(menuButton.x, menuButton.y, menuButton.w, menuButton.h);
			ctx.fillText("[MENU]", menuButton.x+2, menuButton.y+3);
			if ( mouse.clicked && contains(menuButton, mouse) === true ) {
				changeState(MENU);
				currentSlide = 1;
			}
			
			if ( mouse.clicked && contains(nextSlideButton, mouse) === true ) 
					currentSlide = 2;
			
			mouse.clicked = false;
			if (currentSlide === 1) {	
				if ( storyBoard1.ready )
					ctx.drawImage(storyBoard1, 0, 0);
					
				ctx.strokeRect(nextSlideButton.x, nextSlideButton.y, nextSlideButton.w, nextSlideButton.h);
				ctx.font = "20pt Arial, sans-serif";
				ctx.fillText("[NEXT]", nextSlideButton.x+5, nextSlideButton.y+30);
			}
			
			if (currentSlide === 2) {
				ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
				if ( storyBoard2.ready )
					ctx.drawImage(storyBoard2, 0, 0);
				ctx.strokeRect(menuButton.x, menuButton.y, menuButton.w, menuButton.h);
				ctx.fillText("[MENU]", menuButton.x+2, menuButton.y+3);
			}		
		}

// Keyboard. Allows player to move character with the WASD keys as well as the arrow keys.
		
		var KEY_UPw = 87, KEY_DOWNs = 83, KEY_LEFTa = 65, KEY_RIGHTd = 68;
		var KEY_UP = 38, KEY_DOWN = 40, KEY_LEFT = 37, KEY_RIGHT = 39;
		
		function handleKeyDown(evt) {
			if ( evt.keyCode == KEY_UP ) {
				swordOut = true;
				SP = 1;
			}
			if ( evt.keyCode == KEY_DOWN ) {
				swordOut = true;
				SP = 3;
			}
			if ( evt.keyCode == KEY_LEFT ) {
				swordOut = true;
				SP = 4;
			}
			if ( evt.keyCode == KEY_RIGHT ) {
				swordOut = true;
				SP = 2;
			}
			if ( evt.keyCode == KEY_UPw ) {
				up = true;
			}
			if ( evt.keyCode == KEY_DOWNs ) {
				down = true;
			}
			if ( evt.keyCode == KEY_LEFTa ) {
				left = true;
			}
			if ( evt.keyCode == KEY_RIGHTd ) {
				right = true;
			}
			
			if ( 37 <= evt.keyCode && evt.keyCode <= 40 )
				evt.preventDefault();
			}
		
		function handleKeyUp(evt) {
			if ( evt.keyCode == KEY_UP )
				swordOut = false;
			if ( evt.keyCode == KEY_DOWN )
				swordOut = false;
			if ( evt.keyCode == KEY_LEFT )
				swordOut = false;
			if ( evt.keyCode == KEY_RIGHT )
				swordOut = false;
			if ( evt.keyCode == KEY_UPw )
				up = false;
			if ( evt.keyCode == KEY_DOWNs )
				down = false;
			if ( evt.keyCode == KEY_LEFTa )
				left = false;
			if ( evt.keyCode == KEY_RIGHTd )
				right = false;
			
			if ( 37 <= evt.keyCode && evt.keyCode <= 40 )
				evt.preventDefault();
			}

// This makes the background be the actual background
			
		function main() {
			ctx = document.getElementById('canvas').getContext("2d");
			document.addEventListener('keydown', handleKeyDown);
			document.addEventListener('keyup', handleKeyUp);
			document.addEventListener('click', getClick);
			document.addEventListener('drag', getClick);
			
			init();
			changeState(MENU);
			//setInterval(function() { update(); draw(ctx); }, 1000/60);
		}
	
		main();
					
	</script>
</body>
</html>