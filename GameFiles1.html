<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Electric Boogaloo</title>
	<style type='text/css'>
		canvas { border: 1px solid black; }
	</style>
</head>
<body>
	<canvas id='canvas' width='800' height='600'></canvas>
	<script type='text/javascript'>
		var ctx;
		var pattern;
		var timerID = -1;
		var mouse = { x: 0, y: 0, clicked: false };
		var playButton = {};
		var menuButton = {};
		var storyButton = {};
		var currentSlide = 1;
		var nextSlideButton = {};

		var player = { x: 5, y: 5, w: 50, h: 50, dx: 5, dy: 5, health: 100 };
		var enemy1 = { x: 745, y: 5, w: 20, h: 20, dx: 1, dy: 1, health: 10 };
		
		var MENU = 0, PLAY = 1, PLOT = 2;
		var state = MENU;
		
		var left = false, right = false, up = false, down = false;			
		var box1 = { x: 100, y: 0,   w: 50,  h: 450 };
		var box2 = { x: 500, y: 0,   w: 100, h: 375 };
		var box3 = { x: 100, y: 550, w: 50,  h: 50 };
		var box4 = { x: 150, y: 60,  w: 250, h: 50};

		player.img = new Image();
		player.ready = false;
		player.img.onload = function() {
			player.ready = true;
		}
		player.img.src = "Player.jpg";
		
		var storyBoard1 = new Image();
		storyBoard1.ready = false;
		storyBoard1.onload = function() {
			storyBoard1.ready = true;
		}
		storyBoard1.src = "MitchellSlide1.jpg";
		
		var storyBoard2 = new Image();
		storyBoard2.ready = false;
		storyBoard2.onload = function() {
			storyBoard2.ready = true;
		}
		storyBoard2.src = "MitchellSlide2.jpg";
		
		function contains( r, m ) {
			return ! (r.x>m.x || r.y>m.y || m.x>r.x+r.w || m.y>r.y+r.h );
		}
		
		function getClick(e) {
			var evt = e || window.event;
			mouse.x = evt.pageX - ctx.canvas.offsetLeft;
			mouse.y = evt.pageY - ctx.canvas.offsetTop;
			mouse.clicked = true;
		}
		function init()
		{
			ctx.font = "24pt Arial, sans-serif";
			ctx.textBaseline = "top";
			playButton.x = ctx.canvas.width/2 - 100;
			playButton.y = ctx.canvas.height/2 - 150;
			playButton.w = 200;
			playButton.h = 100;
			
			menuButton.x = ctx.canvas.width - 65;
			menuButton.y = ctx.canvas.height - 30;
			menuButton.w = 60;
			menuButton.h = 25;
			
			storyButton.x = ctx.canvas.width/2 - 100;
			storyButton.y = ctx.canvas.height/2;
			storyButton.w = 200;
			storyButton.h = 100;
			
			nextSlideButton.x = 645
			nextSlideButton.y = 0
			nextSlideButton.w = 100;
			nextSlideButton.h = 100;
		}
		// changes game state when clicked
		function changeState( newState ) {
			if ( timerID != -1 )
				clearInterval(timerID);
			if ( newState === MENU )
				timerID = setInterval(function() { updateMenu(); drawMenu(ctx); }, 1000/60);
			else if ( newState === PLAY ) {
				//reset();
				timerID = setInterval(function() { update(); drawPlay(ctx); }, 1000/60);
			}
			else if ( newState === PLOT ) {
				timerID = setInterval(function() { update(); drawPlot(ctx); }, 1000/60);
			}
			state = newState;
		}
			
		function update() {
			var orig = { x: player.x, y: player.y };
			
			// move the player
			if ( up == true )
				player.y -= player.dy;
			if ( down == true )
				player.y += player.dy;					
			if ( left == true )
				player.x -= player.dx;
			if ( right == true )
				player.x += player.dx;
			
			//check if the player ran into a box and, if so, move back
			if ( collide(player, box1) || collide(player, box2) || collide(player, box3) || collide(player, box4))  {
				player.x = orig.x;
				player.y = orig.y; }
				
			orig = { x: enemy1.x, y: enemy1.y };
			//var enemy1 = { x: 745, y: 5, w: 20, h: 20, dx: 1, dy: 1, health: 10 };
			if ( enemy1.x < 0 || enemy1.x < box1.w + box1.x || enemy1.x < box2.w + box2.x || enemy1.x < box3.w + box3.x || enemy1.x < box4.w + box4.x){
				//enemy1.x = 0;
				enemy1.dx = -enemy1.dx;
			}
			else if ( enemy1.x + enemy1.w > ctx.canvas.width ){
				//enemy1.x = ctx.canvas.width - enemy1.w;
				enemy1.dx = -enemy1.dx;
			}
			else if ( enemy1.y < 0 || enemy1.y < box1.h + box1.y || enemy1.y < box2.h + box2.y || enemy1.y < box3.h + box3.y || enemy1.y < box4.h + box4.y){
				//enemy1.y = 0;
				enemy1.dy = -enemy1.dy;
			}
			else if ( enemy1.y + enemy.h > ctx.canvas.height || enemy1.y + enemy.h > box1.y || enemy1.y + enemy.h > box2.y || enemy1.y + enemy.h > box3.y || enemy1.y + enemy.h > box4.y){
				//enemy1.y = ctx.canvas.height - enemy1.h;
				enemy1.dy = -enemy1.dy;
			}
			enemy1.x += enemy1.dx;	
			enemy1.y += enemy1.dy;
			
			//make sure the player didn't go out of bounds
			if ( player.x < 0 )
				player.x = 0;
			else if ( player.x + player.w > ctx.canvas.width )
				player.x = ctx.canvas.width - player.w;
			if ( player.y < 0)
				player.y = 0;
			else if ( player.y + player.h > ctx.canvas.height )
				player.y = ctx.canvas.height - player.h;
		}
		
		function updateMenu() {
			if ( mouse.clicked && contains(playButton, mouse) === true ) {
					changeState(PLAY);
			}
			else if ( mouse.clicked && contains (storyButton, mouse) === true ) {
					changeState(PLOT);
			}
			mouse.clicked = false;
		}
		
		function drawMenu(ctx) {
			ctx.font = "24pt Arial, sans-serif";
			ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
			ctx.strokeRect(playButton.x, playButton.y, playButton.w, playButton.h);
			ctx.strokeRect(storyButton.x, storyButton.y, storyButton.w, storyButton.h);
			ctx.fillText("[PLAY]", playButton.x+55, playButton.y+30);
			ctx.fillText("[PLOT]", storyButton.x+55, storyButton.y+30);
		}
		function collide( player, box ) {
			if( player.x >= box.x + box.w )
				return false;
			if ( player.y >= box.y + box.h )
				return false;
			if ( box.x >= player.x + player.w )
				return false;
			if ( box.y >= player.y + player.h )
				return false;
				
			/*if( enemy1.x >= box.x + box.w )
				return false;
			if ( enemy1.y >= box.y + box.h )
				return false;
			if ( enemy1.x <= box.x )
				return false;
			if (  )
				return false;*/	
			
			return true;
		}

// Draws the character as well as the obsticals on the map
		
		function drawPlay(ctx) {
			ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
			
			ctx.rect(0, 0, 800, 600);
			ctx.fillStyle = pattern;
			ctx.fill();
			
			ctx.fillStyle = "#000000";
			ctx.font = "12pt Arial, sans-serif";
			ctx.strokeRect(menuButton.x, menuButton.y, menuButton.w, menuButton.h);
			ctx.fillText("[MENU]", menuButton.x+2, menuButton.y+3);
			
			if ( mouse.clicked && contains(menuButton, mouse) === true ) {
				changeState(MENU);
				ctx.font = "24pt Arial, sans-serif";
			}
			mouse.clicked = false;
			
			ctx.fillStyle = "#7FFFD4";
			ctx.fillRect(enemy1.x, enemy1.y, enemy1.w, enemy1.h);

			if ( player.ready )
				ctx.drawImage(player.img, player.x, player.y );

			ctx.fillStyle = "#000000";
			ctx.fillRect(box1.x, box1.y, box1.w, box1.h);
			ctx.fillRect(box2.x, box2.y, box2.w, box2.h);
			ctx.fillRect(box3.x, box3.y, box3.w, box3.h);
			ctx.fillRect(box4.x, box4.y, box4.w, box4.h);
		}

// Draws the plot screens.
		
		function drawPlot(ctx) {
			ctx.font = "12pt Arial, sans-serif";
			ctx.strokeRect(menuButton.x, menuButton.y, menuButton.w, menuButton.h);
			ctx.fillText("[MENU]", menuButton.x+2, menuButton.y+3);
			if ( mouse.clicked && contains(menuButton, mouse) === true ) {
				changeState(MENU);
				currentSlide = 1;
			}
			
			if ( mouse.clicked && contains(nextSlideButton, mouse) === true ) 
					currentSlide = 2;
			
			mouse.clicked = false;
			if (currentSlide === 1) {	
				if ( storyBoard1.ready )
					ctx.drawImage(storyBoard1, 0, 0);
					
				ctx.strokeRect(nextSlideButton.x, nextSlideButton.y, nextSlideButton.w, nextSlideButton.h);
				ctx.font = "20pt Arial, sans-serif";
				ctx.fillText("[NEXT]", nextSlideButton.x+5, nextSlideButton.y+30);
			}
			
			if (currentSlide === 2) {
				ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
				if ( storyBoard2.ready )
					ctx.drawImage(storyBoard2, 0, 0);
				ctx.strokeRect(menuButton.x, menuButton.y, menuButton.w, menuButton.h);
				ctx.fillText("[MENU]", menuButton.x+2, menuButton.y+3);
			}		
		}

// Keyboard. Allows player to move character with the WASD keys as well as the arrow keys.
		
		var KEY_UPw = 87, KEY_DOWNs = 83, KEY_LEFTa = 65, KEY_RIGHTd = 68;
		var KEY_UP = 38, KEY_DOWN = 40, KEY_LEFT = 37, KEY_RIGHT = 39;
		
		function handleKeyDown(evt) {
			if ( evt.keyCode == KEY_UP )
				up = true;
			if ( evt.keyCode == KEY_DOWN )
				down = true;
			if ( evt.keyCode == KEY_LEFT )
				left = true;
			if ( evt.keyCode == KEY_RIGHT )
				right = true;
			if ( evt.keyCode == KEY_UPw )
				up = true;
			if ( evt.keyCode == KEY_DOWNs )
				down = true;
			if ( evt.keyCode == KEY_LEFTa )
				left = true;
			if ( evt.keyCode == KEY_RIGHTd )
				right = true;
			
			if ( 37 <= evt.keyCode && evt.keyCode <= 40 )
				evt.preventDefault();
			}
		
		function handleKeyUp(evt) {
			if ( evt.keyCode == KEY_UP )
				up = false;
			if ( evt.keyCode == KEY_DOWN )
				down = false;
			if ( evt.keyCode == KEY_LEFT )
				left = false;
			if ( evt.keyCode == KEY_RIGHT )
				right = false;
			if ( evt.keyCode == KEY_UPw )
				up = false;
			if ( evt.keyCode == KEY_DOWNs )
				down = false;
			if ( evt.keyCode == KEY_LEFTa )
				left = false;
			if ( evt.keyCode == KEY_RIGHTd )
				right = false;
			
			if ( 37 <= evt.keyCode && evt.keyCode <= 40 )
				evt.preventDefault();
			}

// This makes the background be the actual background
			
		function main() {
			ctx = document.getElementById('canvas').getContext("2d");
			document.addEventListener('keydown', handleKeyDown);
			document.addEventListener('keyup', handleKeyUp);
			document.addEventListener('click', getClick);
			document.addEventListener('drag', getClick);
			
			var BGI = new Image();
			BGI.onload = function() {
				pattern = ctx.createPattern(BGI, 'repeat');
			}
			BGI.src = 'BGI.jpg';
			init();
			changeState(MENU);
			//setInterval(function() { update(); draw(ctx); }, 1000/60);
		}
	
		main();
					
	</script>
</body>
</html>